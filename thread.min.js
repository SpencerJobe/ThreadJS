// MIT License (c)2018 Spencer A. Jobe

(function loadThread(win){var gSprint=100;var gSleep=800;var gActiveThreads=[];var gTargetIndex=0;var gUpdatedList=[];var Thread=function(){var self=this;self.steps=[];self.labels={};self.index=0;var proxy=function(label,step){if(typeof label==="string"){self.labels[label]=self.steps.length;}else{step=label;}
self.steps.push(step);return proxy;};proxy.run=function(){gActiveThreads.push(self);};return proxy;};Thread.prototype.run=function(){var result=this.steps[this.index]();if(typeof result==="string"){if(this.labels.hasOwnProperty(result)){this.index=this.labels[result];}else{throw new Error("Thread does not have label '"+result+"'");}}else if(result===false||result===undefined){this.index+=1;}};var runThreads=function(time){var thread;while(gTargetIndex<gActiveThreads.length){thread=gActiveThreads[gTargetIndex];thread.run();gTargetIndex+=1;if(thread.index<thread.steps.length){gUpdatedList.unshift(thread);}
if(Date.now()-time>gSprint){return false;}}
gTargetIndex=0;gActiveThreads=gUpdatedList;gUpdatedList=[];return true;};var threadManager=function(){var time=Date.now();if(gActiveThreads.length>0){while(Date.now()-time<gSprint){if(!runThreads(time)){break;}}}
setTimeout(threadManager,gSleep);};setTimeout(threadManager,100);win.Thread=Thread;}(window));